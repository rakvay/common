Пространства имен – это одна из особенностей ядра Linux, введенная в версии 2.6.24 в 2008 году. Они обеспечивают процессы собственным системным представлением, тем самым изолируя независимые процессы друг от друга. Другими словами, пространства имен определяют набор ресурсов, которые может использовать процесс (нельзя взаимодействовать с тем, что не видно). На высоком уровне они позволяют тонко разделять глобальные ресурсы операционной системы, такие как точки монтирования, сетевой стек и утилиты межпроцессного взаимодействия.

Сильная сторона пространств имен в том, что они ограничивают доступ к системным ресурсам без информирования об этом выполняющегося процесса. В Linux они обычно представлены как файлы в директории /proc/<pid>/ns

Пространства имен создаются с помощью системного вызова clone.
Пространства имен также можно создавать с помощью системного вызова unshare. Разница между clone и unshare в том, что первый порождает новый процесс внутри нового набора пространств имен, а последний перемещает в новый набор пространств имен текущий процесс.

Если представить, что пространства имен – это ящики для процессов, содержащие некоторые абстрагированные системные ресурсы, то удобной особенностью таких ящиков будет возможность добавлять и удалять их содержимое, не влияя на содержимое других ящиков. Либо, если изолированный процесс А вдруг обезумит и решит удалить всю файловую систему или сетевой стек в своем ящике (наборе пространств имен), то подобное действие не повлияет на абстракцию этих ресурсов, предоставленную для процесса В, находящегося в другом ящике.

Разница же между VM и контейнером в том, что контейнеры разделяют и используют непосредственно ядро ОС, что делает их существенно легче виртуальных машин ввиду отсутствия аппаратной эмуляции. Такое повышение общей производительности в основном обеспечено использованием пространств имен, интегрированных непосредственно в ядро Linux. Но при этом существует и ряд реализаций облегченных виртуальных машин.

 В текущей стабильной версии ядра 5.7 есть семь пространств имен:

    PID: изоляция дерева системных процессов;
    NET: изоляция сетевого стека хоста;
    MNT: изоляция точек монтирования файловой системы хоста;
    UTS: изоляция имени хоста;
    IPC: изоляция утилит межпроцессного взаимодействия (сегменты разделяемой памяти, семафоры);
    USER: изоляция ID пользователей системы;
    CGROUP: изоляция виртуальной файловой системы cgroup хоста.


Как уже говорилось, процесс может иметь несколько ID в зависимости от количества пространств имен, в которых он находится. 

Подытожим тему пространств имен процессов:

    - процессы внутри пространства имен видят и могут взаимодействовать только с процессами в том же пространстве имен PID (изоляция);
    - каждое пространство имен PID имеет собственную нумерацию, начинающуюся с 1;
    - эта нумерация уникальна для каждого пространства имен – если PID 1 исчезает, тогда все пространство имен удаляется;
    - пространства имен могут вкладываться друг в друга;
    - в случае вложения у процесса получается несколько PID;
    - все ps-подобные команды для реализации своей функциональности используют монтирование виртуальной файловой системы procfs.

Сетевое пространство имен ограничивает видимость процесса внутри сети. Оно позволяет процессу располагать собственной частью сетевого стека хоста (набором сетевых интерфейсов, хуков Netfilter и правилами маршрутизации).

Подытожим о сетевых пространствах имен:

    - Процессы внутри определенного сетевого пространства имен получают собственный закрытый сетевой стек, включая сетевые интерфейсы, таблицы маршрутов, правила iptables, сокеты (ss, netstat);
    - Соединение между сетевыми пространствами имен можно реализовать с помощью двух виртуальных интерфейсов;
    - Взаимодействие между изолированными сетевыми стеками в одном пространстве имен реализуется с помощью моста;
    - Пространство имен NET можно использовать для симуляции «ящика» процессов Linux, когда только несколько из них смогут связываться с внешним миром (для этого нужно будет удалить  предустановленный шлюз хоста из правил маршрутизации некоторых пространств имен NET).
